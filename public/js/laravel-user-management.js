!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var a=t();for(var s in a)("object"==typeof exports?exports:e)[s]=a[s]}}(self,function(){return function(){"use strict";return $(function(){var e,t=$(".datatables-users"),a=$(".select2"),s=baseUrl+"app/user/view/account",n=$("#offcanvasAddUser"),r=document.getElementById("addNewUserForm");function o(e){if(e.length<=0)return e;var t=$.parseHTML(e),a="";return $.each(t,function(e,t){t.classList&&t.classList.contains("user-name")?a+=t.lastChild?t.lastChild.textContent:"":t.classList&&t.classList.contains("user-email")?a+=t.textContent:t.innerText?a+=t.innerText:t.textContent&&(a+=t.textContent)}),a.trim()}function i(e){var t=$("#addNewUserForm"),a=t.find('button[type="submit"]');e?(t.find("input, select, textarea").prop("disabled",!0),a.prop("disabled",!0).html('<i class="ti ti-loader-2 ti-spin me-2"></i>Loading...')):(t.find("input, select, textarea").prop("disabled",!1),a.prop("disabled",!1).html('<i class="ti ti-user-plus me-2"></i>Add User'))}if(a.length&&a.each(function(){var e=$(this);e.wrap('<div class="position-relative"></div>').select2({placeholder:e.data("placeholder")||"Select an option",allowClear:!0,width:"100%",dropdownParent:e.parent()})}),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content"),"X-Requested-With":"XMLHttpRequest"},error:function(e,t,a){console.error("AJAX Error:",{status:e.status,statusText:e.statusText,responseText:e.responseText,error:a}),window.Swal&&Swal.fire({icon:"error",title:"Connection Error",text:"An error occurred while communicating with the server. Please try again.",customClass:{confirmButton:"btn btn-primary"}})}}),t.length&&(e=t.DataTable({processing:!0,serverSide:!0,ajax:{url:baseUrl+"user-list",type:"GET",error:function(e,t,a){console.error("DataTables AJAX Error:",t)}},columns:[{data:""},{data:"id"},{data:"name"},{data:"email"},{data:"email_verified_at"},{data:"action"}],columnDefs:[{className:"control",searchable:!1,orderable:!1,responsivePriority:2,targets:0,render:function(e,t,a,s){return""}},{searchable:!1,orderable:!1,targets:1,render:function(e,t,a,s){return'<span class="fw-medium">'.concat(a.fake_id||a.id,"</span>")}},{targets:2,responsivePriority:4,render:function(e,t,a,n){var r=a.name,o=["success","danger","warning","info","dark","primary","secondary"][Math.floor(7*Math.random())],i=r.match(/\b\w/g)||[];return'<div class="d-flex justify-content-start align-items-center user-name"><div class="avatar-wrapper"><div class="avatar avatar-sm me-3">'+('<span class="avatar-initial rounded-circle bg-label-'+o+'">'+((i.shift()||"")+(i.pop()||"")).toUpperCase()+"</span>")+'</div></div><div class="d-flex flex-column"><a href="'+s+'" class="text-body text-truncate text-decoration-none"><span class="fw-semibold">'+r+"</span></a></div></div>"}},{targets:3,render:function(e,t,a,s){var n=a.email;return'<a href="mailto:'+n+'" class="user-email text-decoration-none">'+n+"</a>"}},{targets:4,className:"text-center",render:function(e,t,a,s){return a.email_verified_at?'<span class="badge bg-success-subtle text-success border border-success-subtle rounded-pill"><i class="ti ti-shield-check me-1"></i>Verified</span>':'<span class="badge bg-danger-subtle text-danger border border-danger-subtle rounded-pill"><i class="ti ti-shield-x me-1"></i>Unverified</span>'}},{targets:-1,title:"Actions",searchable:!1,orderable:!1,className:"text-nowrap",render:function(e,t,a,n){return'<div class="d-flex align-items-center gap-1"><button class="btn btn-sm btn-icon btn-text-secondary rounded-pill waves-effect edit-record" data-id="'+a.id+'" data-bs-toggle="offcanvas" data-bs-target="#offcanvasAddUser" data-bs-original-title="Edit User" title="Edit User"><i class="ti ti-edit ti-md"></i></button><button class="btn btn-sm btn-icon btn-text-secondary rounded-pill waves-effect delete-record" data-id="'+a.id+'" data-bs-original-title="Delete User" title="Delete User"><i class="ti ti-trash ti-md"></i></button><div class="dropdown"><button class="btn btn-sm btn-icon btn-text-secondary rounded-pill waves-effect dropdown-toggle hide-arrow" data-bs-toggle="dropdown" aria-expanded="false"><i class="ti ti-dots-vertical ti-md"></i></button><ul class="dropdown-menu dropdown-menu-end"><li><a class="dropdown-item" href="'+s+'"><i class="ti ti-eye me-2"></i>View Details</a></li><li><a class="dropdown-item" href="javascript:void(0);"><i class="ti ti-user-pause me-2"></i>Suspend User</a></li><li><a class="dropdown-item" href="javascript:void(0);"><i class="ti ti-lock me-2"></i>Reset Password</a></li><li><hr class="dropdown-divider"></li><li><a class="dropdown-item text-danger" href="javascript:void(0);"><i class="ti ti-user-x me-2"></i>Deactivate</a></li></ul></div></div>'}}],order:[[2,"desc"]],dom:'<"row mx-1"<"col-sm-12 col-md-3"<"me-3"l>><"col-sm-12 col-md-9"<"dt-action-buttons text-xl-end text-lg-start text-md-end text-start d-flex align-items-center justify-content-end flex-md-row flex-column mb-3 mb-md-0 gap-3"fB>>>t<"row mx-2"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',language:{sLengthMenu:"_MENU_",search:"",searchPlaceholder:"Search users...",info:"Showing _START_ to _END_ of _TOTAL_ users",infoEmpty:"No users found",infoFiltered:"(filtered from _MAX_ total users)",paginate:{first:"First",last:"Last",next:'<i class="ti ti-chevron-right"></i>',previous:'<i class="ti ti-chevron-left"></i>'}},buttons:[{extend:"collection",className:"btn btn-outline-secondary dropdown-toggle me-2 waves-effect waves-light",text:'<i class="ti ti-download me-1"></i>Export',buttons:[{extend:"print",title:"MOTAC Users Report",text:'<i class="ti ti-printer me-2"></i>Print',className:"dropdown-item",exportOptions:{columns:[2,3],format:{body:function(e,t,a){if(e.length<=0)return e;var s=$.parseHTML(e),n="";return $.each(s,function(e,t){void 0!==t.classList&&t.classList.contains("user-name")?n+=t.lastChild.textContent:t.innerText?n+=t.innerText:t.textContent&&(n+=t.textContent)}),n}}},customize:function(e){$(e.document.body).css("color","#333").css("border-color","#ddd").css("background-color","#fff"),$(e.document.body).find("table").addClass("compact").css("color","inherit").css("border-color","inherit").css("background-color","inherit"),$(e.document.body).prepend('<div style="text-align: center; margin-bottom: 20px;"><h2>MOTAC Integrated Resource Management System</h2><h3>Users Report</h3><p>Generated on: '+(new Date).toLocaleDateString()+"</p></div>")}},{extend:"csv",title:"MOTAC_Users_"+(new Date).toISOString().slice(0,10),text:'<i class="ti ti-file-text me-2"></i>CSV',className:"dropdown-item",exportOptions:{columns:[2,3],format:{body:function(e,t,a){return o(e)}}}},{extend:"excel",title:"MOTAC_Users_"+(new Date).toISOString().slice(0,10),text:'<i class="ti ti-file-spreadsheet me-2"></i>Excel',className:"dropdown-item",exportOptions:{columns:[2,3],format:{body:function(e,t,a){return o(e)}}}},{extend:"pdf",title:"MOTAC Users Report",text:'<i class="ti ti-file-text me-2"></i>PDF',className:"dropdown-item",exportOptions:{columns:[2,3],format:{body:function(e,t,a){return o(e)}}},customize:function(e){e.content[1].table.widths=["50%","50%"],e.styles.tableHeader.fontSize=12,e.styles.tableHeader.fillColor="#0066cc",e.styles.tableBodyOdd.fillColor="#f9f9f9"}},{extend:"copy",title:"MOTAC Users",text:'<i class="ti ti-copy me-2"></i>Copy to Clipboard',className:"dropdown-item",exportOptions:{columns:[2,3],format:{body:function(e,t,a){return o(e)}}}}]},{text:'<i class="ti ti-plus me-0 me-sm-1 ti-xs"></i><span class="d-none d-sm-inline-block">Add New User</span>',className:"add-new btn btn-primary waves-effect waves-light",attr:{"data-bs-toggle":"offcanvas","data-bs-target":"#offcanvasAddUser"}}],responsive:{details:{display:$.fn.dataTable.Responsive.display.modal({header:function(e){return"User Details: "+e.data().name}}),type:"column",renderer:function(e,t,a){var s=$.map(a,function(e,t){return""!==e.title?'<tr data-dt-row="'+e.rowIndex+'" data-dt-column="'+e.columnIndex+'"><td class="fw-medium">'+e.title+":</td> <td>"+e.data+"</td></tr>":""}).join("");return!!s&&$('<table class="table table-borderless"/><tbody />').append(s)}}},pageLength:10,lengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],scrollX:!0,autoWidth:!1,initComplete:function(){console.log("DataTable initialized successfully"),$(".dataTables_filter input").addClass("form-control form-control-sm"),$(".dataTables_length select").addClass("form-select form-select-sm")},drawCallback:function(){$("[title]").tooltip()}})),$(document).on("click",".delete-record",function(){var t=$(this).data("id"),a=$(".dtr-bs-modal.show");a.length&&a.modal("hide"),Swal.fire({title:"Are you sure?",text:"This action cannot be undone! The user will be permanently deleted.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete user!",cancelButtonText:"Cancel",customClass:{confirmButton:"btn btn-danger me-3 waves-effect waves-light",cancelButton:"btn btn-outline-secondary waves-effect"},buttonsStyling:!1,reverseButtons:!0}).then(function(a){a.value?(Swal.fire({title:"Deleting user...",text:"Please wait while we process your request.",allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1,didOpen:function(){Swal.showLoading()}}),$.ajax({type:"DELETE",url:"".concat(baseUrl,"user-list/").concat(t),success:function(t){e.draw(!1),Swal.fire({icon:"success",title:"Deleted!",text:"The user has been successfully deleted.",customClass:{confirmButton:"btn btn-success waves-effect waves-light"},buttonsStyling:!1})},error:function(e,t,a){console.error("Delete Error:",e.responseText),Swal.fire({icon:"error",title:"Deletion Failed",text:"An error occurred while deleting the user. Please try again.",customClass:{confirmButton:"btn btn-primary waves-effect waves-light"},buttonsStyling:!1})}})):a.dismiss===Swal.DismissReason.cancel&&Swal.fire({title:"Cancelled",text:"The user deletion has been cancelled.",icon:"info",customClass:{confirmButton:"btn btn-primary waves-effect waves-light"},buttonsStyling:!1})})}),$(document).on("click",".edit-record",function(){var e=$(this).data("id"),t=$(".dtr-bs-modal.show");t.length&&t.modal("hide"),$("#offcanvasAddUserLabel").html('<i class="ti ti-user-edit me-2"></i>Edit User'),i(!0),$.get("".concat(baseUrl,"user-list/").concat(e,"/edit")).done(function(e){$("#user_id").val(e.id),$("#add-user-fullname").val(e.name),$("#add-user-email").val(e.email),$("#add-user-contact").val(e.contact||""),$("#add-user-company").val(e.company||""),e.country&&$("#add-user-country").val(e.country).trigger("change"),i(!1)}).fail(function(e,t,a){console.error("Edit User Fetch Error:",a),i(!1),Swal.fire({icon:"error",title:"Error Loading User Data",text:"Unable to load user information. Please try again.",customClass:{confirmButton:"btn btn-primary waves-effect waves-light"},buttonsStyling:!1})})}),$(".add-new").on("click",function(){$("#user_id").val(""),$("#offcanvasAddUserLabel").html('<i class="ti ti-user-plus me-2"></i>Add New User'),"undefined"!=typeof fv&&fv.resetForm(!0),$("#addNewUserForm")[0].reset(),$(".select2").val(null).trigger("change")}),setTimeout(function(){$(".dataTables_filter .form-control").removeClass("form-control-sm"),$(".dataTables_length .form-select").removeClass("form-select-sm"),$(".dataTables_filter input").addClass("rounded-pill"),$(".dataTables_length select").addClass("rounded-pill"),$(".dataTables_filter input").attr("placeholder","Search users by name or email...")},300),r){var l=FormValidation.formValidation(r,{fields:{name:{validators:{notEmpty:{message:"Full name is required"},stringLength:{min:2,max:100,message:"Name must be between 2 and 100 characters"},regexp:{regexp:/^[a-zA-Z\s]+$/,message:"Name can only contain letters and spaces"}}},email:{validators:{notEmpty:{message:"Email address is required"},emailAddress:{message:"Please enter a valid email address"},stringLength:{max:255,message:"Email address is too long"}}},userContact:{validators:{notEmpty:{message:"Contact number is required"},phone:{country:"MY",message:"Please enter a valid Malaysian phone number"}}},company:{validators:{notEmpty:{message:"Company/Organization is required"},stringLength:{min:2,max:100,message:"Company name must be between 2 and 100 characters"}}},country:{validators:{notEmpty:{message:"Please select a country"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap5:new FormValidation.plugins.Bootstrap5({eleValidClass:"",rowSelector:function(e,t){return".mb-3"}}),submitButton:new FormValidation.plugins.SubmitButton,autoFocus:new FormValidation.plugins.AutoFocus,icon:new FormValidation.plugins.Icon({valid:"ti ti-check",invalid:"ti ti-x",validating:"ti ti-loader-2 ti-spin"})}}).on("core.form.valid",function(){var t=$("#addNewUserForm").serialize(),a=""!==$("#user_id").val();i(!0);var s=a?"PUT":"POST",r=a?"".concat(baseUrl,"user-list/").concat($("#user_id").val()):"".concat(baseUrl,"user-list");$.ajax({data:t,url:r,type:s,success:function(t){i(!1),e.draw(!1),n.offcanvas("hide"),Swal.fire({icon:"success",title:"User ".concat(a?"Updated":"Created"," Successfully!"),text:"The user has been ".concat(a?"updated":"created"," successfully."),customClass:{confirmButton:"btn btn-success waves-effect waves-light"},buttonsStyling:!1})},error:function(e,t,s){i(!1),console.error("Form Submission Error:",e.responseText);var r="An error occurred while saving the user.";e.responseJSON&&e.responseJSON.message?r=e.responseJSON.message:422===e.status?r="Please check your input data and try again.":409===e.status&&(r="A user with this email address already exists."),n.offcanvas("hide"),Swal.fire({title:"".concat(a?"Update":"Creation"," Failed"),text:r,icon:"error",customClass:{confirmButton:"btn btn-primary waves-effect waves-light"},buttonsStyling:!1})}})});n.on("hidden.bs.offcanvas",function(){l.resetForm(!0),$("#addNewUserForm")[0].reset(),$(".select2").val(null).trigger("change"),$("#offcanvasAddUserLabel").html('<i class="ti ti-user-plus me-2"></i>Add New User'),i(!1)})}var d,c=document.querySelectorAll(".phone-mask");c&&window.Cleave&&c.forEach(function(e){new Cleave(e,{phone:!0,phoneRegionCode:"MY",prefix:"+60",delimiter:" ",blocks:[3,2,4,4],uppercase:!1})}),$(document).on("keydown",function(e){e.ctrlKey&&e.altKey&&78===e.keyCode&&(e.preventDefault(),$(".add-new").click()),27===e.keyCode&&n.hasClass("show")&&n.offcanvas("hide")}),$(document).on("keyup",".dataTables_filter input",function(){clearTimeout(d);var e=$(this).val();d=setTimeout(function(){console.log("Searching for:",e)},300)}),$(".edit-record").attr("aria-label","Edit user"),$(".delete-record").attr("aria-label","Delete user"),$(".datatables-users").attr("role","grid"),$(".datatables-users thead").attr("role","rowgroup"),$(".datatables-users tbody").attr("role","rowgroup"),t.on("draw.dt",function(){var t=e.page.info(),a="Table updated. Showing ".concat(t.start+1," to ").concat(t.end," of ").concat(t.recordsTotal," users."),s=$("#table-announcements");s.length||(s=$('<div id="table-announcements" class="sr-only" aria-live="polite" aria-atomic="true"></div>'),$("body").append(s)),s.text(a)}),console.log("âœ… MOTAC User Management module initialized successfully"),console.log("ðŸ“Š DataTable configured with server-side processing"),console.log("ðŸ”’ CSRF protection enabled for all AJAX requests"),console.log("âœ¨ Form validation and UI enhancements applied"),$(document).trigger("motac:user-management:ready",{dataTable:e,formValidation:"undefined"!=typeof fv?fv:null,timestamp:(new Date).toISOString()})}),window.refreshUsersTable=function(){"undefined"!=typeof dt_user&&dt_user?(dt_user.ajax.reload(null,!1),console.log("Users table refreshed")):console.warn("Users DataTable not initialized")},window.getUsersTableData=function(){return"undefined"!=typeof dt_user&&dt_user?dt_user.data().toArray():[]},{}}()});